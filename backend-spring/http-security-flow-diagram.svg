<svg viewBox="0 0 1000 700" xmlns="http://www.w3.org/2000/svg">
  <!-- Title -->
  <rect x="250" y="20" width="500" height="50" rx="5" fill="#3498db" />
  <text x="500" y="50" text-anchor="middle" font-family="Arial" font-size="20" font-weight="bold" fill="white">HTTP Request Flow</text>

  <!-- First split -->
  <line x1="500" y1="70" x2="500" y2="100" stroke="#2c3e50" stroke-width="2" />
  <line x1="350" y1="100" x2="650" y2="100" stroke="#2c3e50" stroke-width="2" />
  <line x1="350" y1="100" x2="350" y2="130" stroke="#2c3e50" stroke-width="2" />
  <line x1="650" y1="100" x2="650" y2="130" stroke="#2c3e50" stroke-width="2" />

  <!-- CORS Config -->
  <rect x="250" y="130" width="200" height="70" rx="5" fill="#e74c3c" />
  <text x="350" y="160" text-anchor="middle" font-family="Arial" font-size="16" font-weight="bold" fill="white">CORSConfig.java</text>
  <text x="350" y="180" text-anchor="middle" font-family="Arial" font-size="12" fill="white">(Adds CORS headers to response)</text>

  <!-- Security Configuration -->
  <rect x="550" y="130" width="200" height="70" rx="5" fill="#e74c3c" />
  <text x="650" y="160" text-anchor="middle" font-family="Arial" font-size="16" font-weight="bold" fill="white">SecurityConfiguration.java</text>
  <text x="650" y="180" text-anchor="middle" font-family="Arial" font-size="12" fill="white">(Configures security filter chain)</text>

  <!-- Second split from Security Configuration -->
  <line x1="650" y1="200" x2="650" y2="230" stroke="#2c3e50" stroke-width="2" />
  <line x1="500" y1="230" x2="800" y2="230" stroke="#2c3e50" stroke-width="2" />
  <line x1="500" y1="230" x2="500" y2="260" stroke="#2c3e50" stroke-width="2" />
  <line x1="800" y1="230" x2="800" y2="260" stroke="#2c3e50" stroke-width="2" />

  <!-- Public Routes -->
  <rect x="400" y="260" width="200" height="70" rx="5" fill="#9b59b6" />
  <text x="500" y="290" text-anchor="middle" font-family="Arial" font-size="16" font-weight="bold" fill="white">Public Routes (/auth/*)</text>
  <text x="500" y="310" text-anchor="middle" font-family="Arial" font-size="12" fill="white"></text>

  <!-- Protected Routes -->
  <rect x="700" y="260" width="200" height="70" rx="5" fill="#9b59b6" />
  <text x="800" y="290" text-anchor="middle" font-family="Arial" font-size="16" font-weight="bold" fill="white">Protected Routes</text>
  <text x="800" y="310" text-anchor="middle" font-family="Arial" font-size="12" fill="white">(Require JWT)</text>

  <!-- Arrows from Public Routes -->
  <line x1="500" y1="330" x2="500" y2="360" stroke="#2c3e50" stroke-width="2" />

  <!-- Arrows from Protected Routes -->
  <line x1="800" y1="330" x2="800" y2="360" stroke="#2c3e50" stroke-width="2" />

  <!-- Security Controller -->
  <rect x="400" y="360" width="200" height="90" rx="5" fill="#2ecc71" />
  <text x="500" y="385" text-anchor="middle" font-family="Arial" font-size="16" font-weight="bold" fill="white">SecurityController.java</text>
  <text x="500" y="405" text-anchor="middle" font-family="Arial" font-size="12" fill="white">- POST /auth/register</text>
  <text x="500" y="425" text-anchor="middle" font-family="Arial" font-size="12" fill="white">- GET /auth/verify?token=</text>

  <!-- JWT Authentication Filter -->
  <rect x="700" y="360" width="200" height="70" rx="5" fill="#2ecc71" />
  <text x="800" y="385" text-anchor="middle" font-family="Arial" font-size="16" font-weight="bold" fill="white">JWTAuthenticationFilter.java</text>
  <text x="800" y="405" text-anchor="middle" font-family="Arial" font-size="12" fill="white">(Processes login requests)</text>

  <!-- Arrows from Security Controller -->
  <line x1="500" y1="450" x2="500" y2="480" stroke="#2c3e50" stroke-width="2" />

  <!-- Arrows from JWT Authentication Filter -->
  <line x1="800" y1="430" x2="800" y2="480" stroke="#2c3e50" stroke-width="2" />

  <!-- Registration Service -->
  <rect x="400" y="480" width="200" height="70" rx="5" fill="#f39c12" />
  <text x="500" y="510" text-anchor="middle" font-family="Arial" font-size="16" font-weight="bold" fill="white">RegistrationService.java</text>
  <text x="500" y="530" text-anchor="middle" font-family="Arial" font-size="12" fill="white">(Publishes verification event)</text>

  <!-- UserDetailsService -->
  <rect x="700" y="480" width="200" height="70" rx="5" fill="#f39c12" />
  <text x="800" y="510" text-anchor="middle" font-family="Arial" font-size="16" font-weight="bold" fill="white">UserDetailsService.java</text>
  <text x="800" y="530" text-anchor="middle" font-family="Arial" font-size="12" fill="white">(Loads user by email)</text>

  <!-- Arrows from Registration Service -->
  <line x1="500" y1="550" x2="500" y2="580" stroke="#2c3e50" stroke-width="2" />

  <!-- Arrows from UserDetailsService -->
  <line x1="800" y1="550" x2="800" y2="580" stroke="#2c3e50" stroke-width="2" />

  <!-- User Registration Event -->
  <rect x="400" y="580" width="200" height="70" rx="5" fill="#1abc9c" />
  <text x="500" y="610" text-anchor="middle" font-family="Arial" font-size="16" font-weight="bold" fill="white">UserRegistrationEvent</text>
  <text x="500" y="630" text-anchor="middle" font-family="Arial" font-size="12" fill="white">(email + verification token)</text>

  <!-- JWT Util -->
  <rect x="700" y="580" width="200" height="70" rx="5" fill="#1abc9c" />
  <text x="800" y="610" text-anchor="middle" font-family="Arial" font-size="16" font-weight="bold" fill="white">JWTUtil.java</text>
  <text x="800" y="630" text-anchor="middle" font-family="Arial" font-size="12" fill="white">(Generates/validates tokens)</text>

  <!-- Arrows from User Registration Event -->
  <line x1="500" y1="650" x2="500" y2="680" stroke="#2c3e50" stroke-width="2" />

  <!-- Arrows from JWT Util -->
  <line x1="800" y1="650" x2="800" y2="680" stroke="#2c3e50" stroke-width="2" />

  <!-- Email Service -->
  <rect x="400" y="680" width="200" height="70" rx="5" fill="#d35400" />
  <text x="500" y="710" text-anchor="middle" font-family="Arial" font-size="16" font-weight="bold" fill="white">EmailService.java</text>
  <text x="500" y="730" text-anchor="middle" font-family="Arial" font-size="12" fill="white">(Listens for event, sends email)</text>

  <!-- JWT Response -->
  <rect x="700" y="680" width="200" height="70" rx="5" fill="#d35400" />
  <text x="800" y="710" text-anchor="middle" font-family="Arial" font-size="16" font-weight="bold" fill="white">JWTResponse.java</text>
  <text x="800" y="730" text-anchor="middle" font-family="ArIal" font-size="12" fill="white">(Contains JWT + metadata)</text>
  
  <!-- Email Verification Flow at bottom -->
  <rect x="100" y="780" width="800" height="50" rx="5" fill="#34495e" />
  <text x="500" y="810" text-anchor="middle" font-family="Arial" font-size="16" font-weight="bold" fill="white">Email Verification Pub/Sub Flow:</text>
  <text x="500" y="830" text-anchor="middle" font-family="Arial" font-size="14" fill="white">1. Registration → 2. Publish Event → 3. Send Email → 4. User Clicks Link → 5. Verify Token → 6. Activate Account</text>
</svg>